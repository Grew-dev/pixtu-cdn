// Pixtu Pixel v1.0.0 | Published By Kimmo Ihanus | Created By Kimmo Ihanus | MIT License
!function(o,r,i,t,n,e,a,c){"use strict";function u(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var l={id:"",version:1},f=function(t){return null!=t&&""!==t},h=function(){return 1*new Date},p=function(){var t,n=navigator.userAgent,e=n.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(e[1])?"IE "+((t=/\brv[ :]+(\d+)/g.exec(n)||[])[1]||""):"Chrome"===e[1]&&null!=(t=n.match(/\b(OPR|Edge)\/(\d+)/))?t.slice(1).join(" ").replace("OPR","Opera"):(e=e[2]?[e[1],e[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=n.match(/version\/(\d+)/i))&&e.splice(1,1,t[1]),e.join(" "))},d=function(){return"ontouchstart"in r},m=function(){return o.navigator.userAgent},g=function(t){return t.hostname!=location.hostname&&0===t.protocol.indexOf("http")};var v=function(){function i(t,n,e){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,i),this.params=[],this.event=t,this.timestamp=n,this.optional=function t(n){return!1===f(n)?"":"object"===s(n)?t(JSON.stringify(n)):"function"==typeof n?t(n()):String(n)}(e),this.buildParams(),this.send(),this.getPrediction(t)}var t,n,e;return t=i,(n=[{key:"buildParams",value:function(){var t=this.getAttribute();for(var n in t)t.hasOwnProperty(n)&&this.setParam(n,t[n](n))}},{key:"getAttribute",value:function(){var n=this;return{id:function(){return l.id},ev:function(){return n.event},ed:function(){return n.optional},v:function(){return l.version},dl:function(){return o.location.href},rl:function(){return r.referrer},ts:function(){return n.timestamp},de:function(){return r.characterSet},sr:function(){return o.screen.width+"x"+o.screen.height},vp:function(){return o.innerWidth+"x"+o.innerHeight},cd:function(){return o.screen.colorDepth},dt:function(){return r.title},bn:function(){return p()},md:function(){return d()},ua:function(){return m()},tz:function(){return(new Date).getTimezoneOffset()},path:function(){return o.location.pathname},url:function(){return o.location.protocol+"//"+o.location.hostname+o.location.pathname},hostname:function(){return o.location.hostname},timezone:function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},width:function(){return o.innerWidth},clicked:function(){return(t=n.event)&&"clicked"==t?1:0;var t}}}},{key:"setParam",value:function(t,n){f(n)?this.params.push("".concat(t,"=").concat(encodeURIComponent(n))):this.params.push("".concat(t,"="))}},{key:"send",value:function(){o.navigator.sendBeacon?this.sendBeacon():this.sendImage()}},{key:"getPrediction",value:function(t){this.src=this.getPredictionUrl();var n=new XMLHttpRequest,e=this.src;n.open("POST",e,!0),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&200===n.status&&console.log(n.responseText)},n.send()}},{key:"sendBeacon",value:function(){o.navigator.sendBeacon(this.getBeaconUrl())}},{key:"sendImage",value:function(){this.img=r.createElement("img"),this.img.src=this.getSourceUrl(),this.img.style.display="none",this.img.width="1",this.img.height="1",r.getElementsByTagName("body")[0].appendChild(this.img);r.getElementsByTagName("body")[0].appendChild(this.img)}},{key:"getSourceUrl",value:function(){return"".concat("http://localhost:8081/pixel.gif","?").concat(this.params.join("&"))}},{key:"getBeaconUrl",value:function(){return"".concat("http://localhost:8081/pixel","?").concat(this.params.join("&"))}},{key:"getPredictionUrl",value:function(){return"".concat("http://localhost:8081/prediction","?").concat(this.params.join("&"))}}])&&u(t.prototype,n),e&&u(t,e),i}();i.process=function(t,n,e){"init"==t?l.id=n:"event"==t&&("pageload"!=n||l.pageLoadOnce?"pageload"!=n&&"pageclose"!=n&&new v(n,h(),e):(l.pageLoadOnce=!0,new v(n,i.t,e)))};for(var y=0,b=i.queue.length;y<b;y++)i.process.apply(i,i.queue[y]);o.onload=function(){for(var t=r.getElementsByTagName("a"),n=0,e=t.length;n<e;n++)t[n].addEventListener("click",function(t){g(this)&&(l.externalHost={link:this.href,time:h()})}.bind(t[n]))}}(window,document,window.pixtu);
(function(){!function(a,b){return"function"==typeof define&&define.amd?define(function(){return b()}):"object"==typeof exports?module.exports=b():a.ifvisible=b()}(this,function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;return i={},c=document,k=!1,l="active",g=6e4,f=!1,b=function(){var a,b,c,d,e,f,g;return a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},e=function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},f={},c="__ceGUID",b=function(a,b,d){return a[c]=void 0,a[c]||(a[c]="ifvisible.object.event.identifier"),f[a[c]]||(f[a[c]]={}),f[a[c]][b]||(f[a[c]][b]=[]),f[a[c]][b].push(d)},d=function(a,b,d){var e,g,h,i,j;if(a[c]&&f[a[c]]&&f[a[c]][b]){for(i=f[a[c]][b],j=[],g=0,h=i.length;h>g;g++)e=i[g],j.push(e(d||{}));return j}},g=function(a,b,d){var e,g,h,i,j;if(d){if(a[c]&&f[a[c]]&&f[a[c]][b])for(j=f[a[c]][b],g=h=0,i=j.length;i>h;g=++h)if(e=j[g],e===d)return f[a[c]][b].splice(g,1),e}else if(a[c]&&f[a[c]]&&f[a[c]][b])return delete f[a[c]][b]},{add:b,remove:g,fire:d}}(),a=function(){var a;return a=!1,function(b,c,d){return a||(a=b.addEventListener?function(a,b,c){return a.addEventListener(b,c,!1)}:b.attachEvent?function(a,b,c){return a.attachEvent("on"+b,c,!1)}:function(a,b,c){return a["on"+b]=c}),a(b,c,d)}}(),d=function(a,b){var d;return c.createEventObject?a.fireEvent("on"+b,d):(d=c.createEvent("HTMLEvents"),d.initEvent(b,!0,!0),!a.dispatchEvent(d))},h=function(){var a,b,d,e,f;for(e=void 0,f=3,d=c.createElement("div"),a=d.getElementsByTagName("i"),b=function(){return d.innerHTML="",a[0]};b(););return f>4?f:e}(),e=!1,n=void 0,"undefined"!=typeof c.hidden?(e="hidden",n="visibilitychange"):"undefined"!=typeof c.mozHidden?(e="mozHidden",n="mozvisibilitychange"):"undefined"!=typeof c.msHidden?(e="msHidden",n="msvisibilitychange"):"undefined"!=typeof c.webkitHidden&&(e="webkitHidden",n="webkitvisibilitychange"),m=function(){var b,d;return b=!1,d=function(){return clearTimeout(b),"active"!==l&&i.wakeup(),f=+new Date,b=setTimeout(function(){return"active"===l?i.idle():void 0},g)},d(),a(c,"mousemove",d),a(c,"keyup",d),a(c,"touchstart",d),a(window,"scroll",d),i.focus(d),i.wakeup(d)},j=function(){var b;return k?!0:(e===!1?(b="blur",9>h&&(b="focusout"),a(window,b,function(){return i.blur()}),a(window,"focus",function(){return i.focus()})):a(c,n,function(){return c[e]?i.blur():i.focus()},!1),k=!0,m())},i={setIdleDuration:function(a){return g=1e3*a},getIdleDuration:function(){return g},getIdleInfo:function(){var a,b;return a=+new Date,b={},"idle"===l?(b.isIdle=!0,b.idleFor=a-f,b.timeLeft=0,b.timeLeftPer=100):(b.isIdle=!1,b.idleFor=a-f,b.timeLeft=f+g-a,b.timeLeftPer=(100-100*b.timeLeft/g).toFixed(2)),b},focus:function(a){return"function"==typeof a?this.on("focus",a):(l="active",b.fire(this,"focus"),b.fire(this,"wakeup"),b.fire(this,"statusChanged",{status:l})),this},blur:function(a){return"function"==typeof a?this.on("blur",a):(l="hidden",b.fire(this,"blur"),b.fire(this,"idle"),b.fire(this,"statusChanged",{status:l})),this},idle:function(a){return"function"==typeof a?this.on("idle",a):(l="idle",b.fire(this,"idle"),b.fire(this,"statusChanged",{status:l})),this},wakeup:function(a){return"function"==typeof a?this.on("wakeup",a):(l="active",b.fire(this,"wakeup"),b.fire(this,"statusChanged",{status:l})),this},on:function(a,c){return j(),b.add(this,a,c),this},off:function(a,c){return j(),b.remove(this,a,c),this},onEvery:function(a,b){var c,d;return j(),c=!1,b&&(d=setInterval(function(){return"active"===l&&c===!1?b():void 0},1e3*a)),{stop:function(){return clearInterval(d)},pause:function(){return c=!0},resume:function(){return c=!1},code:d,callback:b}},now:function(a){return j(),l===(a||"active")}}})}).call(this);(function(){!function(e,t){return"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?void define([],function(){return e.TimeMe=t()}):e.TimeMe=t()}(this,function(){var e={startStopTimes:{},idleTimeoutMs:6e4,currentIdleTimeMs:0,checkStateRateMs:250,active:!1,idle:!1,currentPageName:"default-page-name",timeElapsedCallbacks:[],userLeftCallbacks:[],userReturnCallbacks:[],startTimer:function(){var t=e.currentPageName;if(void 0===e.startStopTimes[t])e.startStopTimes[t]=[];else{var n=e.startStopTimes[t],i=n[n.length-1];if(void 0!==i&&void 0===i.stopTime)return}e.startStopTimes[t].push({startTime:new Date,stopTime:void 0}),e.active=!0},stopTimer:function(){var t=e.currentPageName,n=e.startStopTimes[t];void 0!==n&&0!==n.length&&(void 0===n[n.length-1].stopTime&&(n[n.length-1].stopTime=new Date),e.active=!1)},getTimeOnCurrentPageInSeconds:function(){return e.getTimeOnPageInSeconds(e.currentPageName)},getTimeOnPageInSeconds:function(t){var n=e.getTimeOnPageInMilliseconds(t);return void 0===n?void 0:e.getTimeOnPageInMilliseconds(t)/1e3},getTimeOnCurrentPageInMilliseconds:function(){return e.getTimeOnPageInMilliseconds(e.currentPageName)},getTimeOnPageInMilliseconds:function(t){var n=0,i=e.startStopTimes[t];if(void 0!==i){for(var s=0,o=0;o<i.length;o++){var a=i[o].startTime,r=i[o].stopTime;void 0===r&&(r=new Date);var d=r-a;s+=d}return n=Number(s)}},getTimeOnAllPagesInSeconds:function(){for(var t=[],n=Object.keys(e.startStopTimes),i=0;i<n.length;i++){var s=n[i],o=e.getTimeOnPageInSeconds(s);t.push({pageName:s,timeOnPage:o})}return t},setIdleDurationInSeconds:function(t){var n=parseFloat(t);if(isNaN(n)!==!1)throw{name:"InvalidDurationException",message:"An invalid duration time ("+t+") was provided."};return e.idleTimeoutMs=1e3*t,this},setCurrentPageName:function(t){return e.currentPageName=t,this},resetRecordedPageTime:function(t){delete e.startStopTimes[t]},resetAllRecordedPageTimes:function(){for(var t=Object.keys(e.startStopTimes),n=0;n<t.length;n++)e.resetRecordedPageTime(t[n])},resetIdleCountdown:function(){e.idle&&e.triggerUserHasReturned(),e.idle=!1,e.currentIdleTimeMs=0},callWhenUserLeaves:function(e,t){this.userLeftCallbacks.push({callback:e,numberOfTimesToInvoke:t})},callWhenUserReturns:function(e,t){this.userReturnCallbacks.push({callback:e,numberOfTimesToInvoke:t})},triggerUserHasReturned:function(){if(!e.active)for(var t=0;t<this.userReturnCallbacks.length;t++){var n=this.userReturnCallbacks[t],i=n.numberOfTimesToInvoke;(isNaN(i)||void 0===i||i>0)&&(n.numberOfTimesToInvoke-=1,n.callback())}e.startTimer()},triggerUserHasLeftPage:function(){if(e.active)for(var t=0;t<this.userLeftCallbacks.length;t++){var n=this.userLeftCallbacks[t],i=n.numberOfTimesToInvoke;(isNaN(i)||void 0===i||i>0)&&(n.numberOfTimesToInvoke-=1,n.callback())}e.stopTimer()},callAfterTimeElapsedInSeconds:function(t,n){e.timeElapsedCallbacks.push({timeInSeconds:t,callback:n,pending:!0})},checkState:function(){for(var t=0;t<e.timeElapsedCallbacks.length;t++)e.timeElapsedCallbacks[t].pending&&e.getTimeOnCurrentPageInSeconds()>e.timeElapsedCallbacks[t].timeInSeconds&&(e.timeElapsedCallbacks[t].callback(),e.timeElapsedCallbacks[t].pending=!1);e.idle===!1&&e.currentIdleTimeMs>e.idleTimeoutMs?(e.idle=!0,e.triggerUserHasLeftPage()):e.currentIdleTimeMs+=e.checkStateRateMs},visibilityChangeEventName:void 0,hiddenPropName:void 0,listenForVisibilityEvents:function(){"undefined"!=typeof document.hidden?(e.hiddenPropName="hidden",e.visibilityChangeEventName="visibilitychange"):"undefined"!=typeof doc.mozHidden?(e.hiddenPropName="mozHidden",e.visibilityChangeEventName="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(e.hiddenPropName="msHidden",e.visibilityChangeEventName="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(e.hiddenPropName="webkitHidden",e.visibilityChangeEventName="webkitvisibilitychange"),document.addEventListener(e.visibilityChangeEventName,function(){document[e.hiddenPropName]?e.triggerUserHasLeftPage():e.triggerUserHasReturned()},!1),window.addEventListener("blur",function(){e.triggerUserHasLeftPage()}),window.addEventListener("focus",function(){e.triggerUserHasReturned()}),document.addEventListener("mousemove",function(){e.resetIdleCountdown()}),document.addEventListener("keyup",function(){e.resetIdleCountdown()}),document.addEventListener("touchstart",function(){e.resetIdleCountdown()}),window.addEventListener("scroll",function(){e.resetIdleCountdown()}),setInterval(function(){e.checkState()},e.checkStateRateMs)},websocket:void 0,websocketHost:void 0,setUpWebsocket:function(t){if(window.WebSocket&&t){var n=t.websocketHost;try{e.websocket=new WebSocket(n),window.onbeforeunload=function(n){e.sendCurrentTime(t.appId)},e.websocket.onopen=function(){e.sendInitWsRequest(t.appId)},e.websocket.onerror=function(e){console&&console.log("Error occurred in websocket connection: "+e)},e.websocket.onmessage=function(e){console&&console.log(e.data)}}catch(i){console&&console.error("Failed to connect to websocket host. Error:"+i)}}return this},websocketSend:function(t){e.websocket.send(JSON.stringify(t))},sendCurrentTime:function(t){var n=e.getTimeOnCurrentPageInMilliseconds(),i={type:"INSERT_TIME",appId:t,timeOnPageMs:n,pageName:e.currentPageName};e.websocketSend(i)},sendInitWsRequest:function(t){var n={type:"INIT",appId:t};e.websocketSend(n)},initialize:function(t){var n=e.idleTimeoutMs||30,i=e.currentPageName||"default-page-name",s=void 0;t&&(n=t.idleTimeoutInSeconds||n,i=t.currentPageName||i,s=t.websocktOptions),e.setIdleDurationInSeconds(n).setCurrentPageName(i).setUpWebsocket(s).listenForVisibilityEvents(),e.startTimer()}};return e})}).call(this);TimeMe.initialize({currentPageName: "my-page",idleTimeoutInSeconds: 30});var timeSpentOnPage=TimeMe.getTimeOnCurrentPageInSeconds();TimeMe.callAfterTimeElapsedInSeconds(2, function(){pixtu("event",TimeMe.getTimeOnCurrentPageInSeconds().toString());});TimeMe.callWhenUserLeaves(function(){pixtu("event",TimeMe.getTimeOnCurrentPageInSeconds().toString());},5);
